Aquatic Species
================
Maddee Rubenson (FlowWest)
2024-02-14

``` r
project_crs <- "ESRI:102039" # NAD83 CONUS Albers USGS Version

flowlines <- readRDS("../data/flowline_geometries.Rds") |>
  st_transform(project_crs) |> 
  st_zm()

catchments <- readRDS("../data/catchments.Rds")
```

## Aquatic Richness Data

### Aquatic Biodiveristy Summary

The aquatic biodiversity summary combines the three measures of
biodiversity developed for ACE into a single metric: 1) aquatic native
species richness, which represents overall native diversity of all
species in the state, both common and rare; 2) aquatic rare species
richness, which represents diversity of rare species; and, 3) aquatic
irreplaceability, which is a weighted measure of rarity and endemism.

<https://data-cdfw.opendata.arcgis.com/datasets/CDFW>::aquatic-species-list-ace-ds2740-2/explore

``` r
# CDFW:
drive_file_by_id("13S1YWYP_t7pb2SUmEWEprJA-tJ-8FM-V") 
```

    ## [1] "temp/Aquatic_Species_List_-_ACE_[ds2740].geojson"

``` r
aquatic_cdfw_sf <- read_sf('temp/Aquatic_Species_List_-_ACE_[ds2740].geojson') |> 
  janitor::clean_names() |> 
  st_transform(project_crs) 
  
aquatic_flowlines_cdfw <- flowlines |> 
  st_join(aquatic_cdfw_sf) |> 
  select(comid, bio_aq_rank_sw) |> glimpse()
```

    ## Rows: 188,694
    ## Columns: 3
    ## $ comid          <int> 20245062, 24085230, 22226684, 22226720, 22226732, 22226…
    ## $ bio_aq_rank_sw <int> NA, NA, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,…
    ## $ geometry       <LINESTRING [m]> LINESTRING (-1758581 168425..., LINESTRING (…

``` r
ggplot() + 
  geom_sf(data = aquatic_flowlines_cdfw, aes(color=as.factor(bio_aq_rank_sw))) 
```

![](aquatic-species_files/figure-gfm/aqu-spec-1.png)<!-- -->

``` r
aquatic_flowlines_cdfw |> 
  st_drop_geometry() |> 
  saveRDS('../data/attr_cdfw_aquatic_species_rank.RDS')
```

### California Freshwater Species Database V2

The California Freshwater Species Database is the first comprehensive
geospatial database of California’s freshwater species compiled and
standardized into single format from nearly 500 sources. It provides a
single source for geodata covering the plants and animals that rely on
California’s freshwater resources to survive.

<https://www.scienceforconservation.org/products/california-freshwater-species-database>

``` r
richness <- read_csv('ca_freshwater_species/RichnessSummary.csv') |> 
  janitor::clean_names() |> 
  rename(huc_12 = au_id) |> 
  mutate(huc_12_aq = as.character(huc_12)) |> glimpse()
```

    ## Rows: 4,450
    ## Columns: 34
    ## $ objectid                   <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, …
    ## $ huc_12                     <dbl> 1.50301e+11, 1.50301e+11, 1.50301e+11, 1.50…
    ## $ species                    <dbl> 8, 27, 8, 9, 56, 9, 13, 43, 38, 2, 2, 2, 3,…
    ## $ species_fish               <dbl> 2, 3, 1, 3, 3, 1, 2, 3, 3, 0, 0, 0, 0, 0, 0…
    ## $ species_crust              <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_herps              <dbl> 1, 1, 1, 2, 4, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2…
    ## $ species_inverts            <dbl> 0, 0, 0, 0, 0, 0, 0, 6, 2, 0, 0, 0, 0, 0, 0…
    ## $ species_mollusks           <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0…
    ## $ species_plants             <dbl> 2, 1, 0, 0, 9, 0, 1, 4, 5, 0, 0, 0, 0, 1, 1…
    ## $ species_birds              <dbl> 1, 19, 4, 2, 37, 5, 7, 27, 23, 0, 0, 0, 1, …
    ## $ species_mammals            <dbl> 2, 3, 2, 2, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0…
    ## $ species_mollusks_crust     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic            <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_fish       <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_crust      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_herps      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_inverts    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_mollusks   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_plants     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_birds      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_mammals    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_vulnerable         <dbl> 3, 14, 2, 4, 14, 6, 7, 11, 15, 1, 1, 1, 2, …
    ## $ species_listed             <dbl> 2, 5, 1, 2, 4, 3, 4, 5, 5, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_vulnerable <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_listed     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ genus                      <dbl> 8, 26, 8, 8, 43, 9, 13, 36, 35, 2, 2, 2, 3,…
    ## $ family                     <dbl> 8, 19, 8, 7, 29, 8, 12, 24, 27, 2, 2, 2, 3,…
    ## $ tax_order                  <dbl> 6, 11, 7, 4, 19, 5, 8, 15, 19, 1, 1, 1, 2, …
    ## $ tax_class                  <dbl> 6, 5, 4, 4, 6, 4, 5, 7, 8, 1, 1, 1, 2, 3, 3…
    ## $ phylum                     <dbl> 2, 2, 1, 1, 2, 1, 2, 3, 4, 1, 1, 1, 1, 2, 2…
    ## $ species_current            <dbl> 2, 20, 3, 3, 41, 5, 8, 31, 32, 0, 0, 0, 0, …
    ## $ species_historical         <dbl> 2, 8, 1, 3, 15, 1, 2, 9, 3, 0, 0, 0, 0, 0, …
    ## $ species_other              <dbl> 5, 5, 4, 5, 7, 4, 5, 6, 7, 2, 2, 2, 3, 2, 3…
    ## $ huc_12_aq                  <chr> "150301010305", "150301010307", "1503010104…

``` r
analysis_units <- read_sf('ca_freshwater_species/AnalysisUnits.shp') |> 
  janitor::clean_names() |> 
  rename(huc_12_aq = au_id) |> 
  mutate(huc_12_aq = as.character(huc_12_aq)) |> 
  left_join(richness) |> 
  st_transform(project_crs) |> 
  glimpse()
```

    ## Rows: 4,450
    ## Columns: 36
    ## $ huc_12_aq                  <chr> "150301010305", "150301010307", "1503010104…
    ## $ au_name                    <chr> "Montana Wash-Colorado River", "Red Spring-…
    ## $ geometry                   <MULTIPOLYGON [m]> MULTIPOLYGON (((-1677510 14...…
    ## $ objectid                   <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, …
    ## $ huc_12                     <dbl> 1.50301e+11, 1.50301e+11, 1.50301e+11, 1.50…
    ## $ species                    <dbl> 8, 27, 8, 9, 56, 9, 13, 43, 38, 2, 2, 2, 3,…
    ## $ species_fish               <dbl> 2, 3, 1, 3, 3, 1, 2, 3, 3, 0, 0, 0, 0, 0, 0…
    ## $ species_crust              <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_herps              <dbl> 1, 1, 1, 2, 4, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2…
    ## $ species_inverts            <dbl> 0, 0, 0, 0, 0, 0, 0, 6, 2, 0, 0, 0, 0, 0, 0…
    ## $ species_mollusks           <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0…
    ## $ species_plants             <dbl> 2, 1, 0, 0, 9, 0, 1, 4, 5, 0, 0, 0, 0, 1, 1…
    ## $ species_birds              <dbl> 1, 19, 4, 2, 37, 5, 7, 27, 23, 0, 0, 0, 1, …
    ## $ species_mammals            <dbl> 2, 3, 2, 2, 3, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0…
    ## $ species_mollusks_crust     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic            <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_fish       <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_crust      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_herps      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_inverts    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_mollusks   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_plants     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_birds      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_mammals    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_vulnerable         <dbl> 3, 14, 2, 4, 14, 6, 7, 11, 15, 1, 1, 1, 2, …
    ## $ species_listed             <dbl> 2, 5, 1, 2, 4, 3, 4, 5, 5, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_vulnerable <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ species_endemic_listed     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
    ## $ genus                      <dbl> 8, 26, 8, 8, 43, 9, 13, 36, 35, 2, 2, 2, 3,…
    ## $ family                     <dbl> 8, 19, 8, 7, 29, 8, 12, 24, 27, 2, 2, 2, 3,…
    ## $ tax_order                  <dbl> 6, 11, 7, 4, 19, 5, 8, 15, 19, 1, 1, 1, 2, …
    ## $ tax_class                  <dbl> 6, 5, 4, 4, 6, 4, 5, 7, 8, 1, 1, 1, 2, 3, 3…
    ## $ phylum                     <dbl> 2, 2, 1, 1, 2, 1, 2, 3, 4, 1, 1, 1, 1, 2, 2…
    ## $ species_current            <dbl> 2, 20, 3, 3, 41, 5, 8, 31, 32, 0, 0, 0, 0, …
    ## $ species_historical         <dbl> 2, 8, 1, 3, 15, 1, 2, 9, 3, 0, 0, 0, 0, 0, …
    ## $ species_other              <dbl> 5, 5, 4, 5, 7, 4, 5, 6, 7, 2, 2, 2, 3, 2, 3…

``` r
flowlines_joined_tnc <- flowlines |> 
  st_join(analysis_units)

ggplot() + 
  geom_sf(data=flowlines_joined_tnc, aes(color=species)) 
```

![](aquatic-species_files/figure-gfm/unnamed-chunk-1-1.png)<!-- -->

``` r
flowlines_joined_tnc |> 
  select(comid, species:species_other) |> 
  st_drop_geometry() |> 
  saveRDS('../data/attr_tnc_aquatic_species_rank.RDS')
```
